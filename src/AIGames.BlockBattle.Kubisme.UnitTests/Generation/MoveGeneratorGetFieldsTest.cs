using NUnit.Framework;
using System;
using System.Linq;

namespace AIGames.BlockBattle.Kubisme.UnitTests.Generation
{
	[TestFixture]
	public class MoveGeneratorGetFieldsTest
	{
		[Test]
		public void GetFields_O_9candidates()
		{
			var exp = new string[]
			{ 
				"..........|..........|..........|XX........|XX........",
				"..........|..........|..........|.XX.......|.XX.......",
				"..........|..........|..........|..XX......|..XX......",
				"..........|..........|..........|...XX.....|...XX.....",
				"..........|..........|..........|....XX....|....XX....",
				"..........|..........|..........|.....XX...|.....XX...",
				"..........|..........|..........|......XX..|......XX..",
				"..........|..........|..........|.......XX.|.......XX.",
				"..........|..........|..........|........XX|........XX",
			};
			AssertGetFields(exp, Block.O);
		}

		[Test]
		public void GetFields_I_17candidates()
		{
			var exp = new string[]
			{ 
				"..........|..........|..........|..........|XXXX......",
				"..........|..........|..........|..........|.XXXX.....",
				"..........|..........|..........|..........|..XXXX....",
				"..........|..........|..........|..........|...XXXX...",
				"..........|..........|..........|..........|....XXXX..",
				"..........|..........|..........|..........|.....XXXX.",
				"..........|..........|..........|..........|......XXXX",

				"..........|X.........|X.........|X.........|X.........",
				"..........|.X........|.X........|.X........|.X........",
				"..........|..X.......|..X.......|..X.......|..X.......",
				"..........|...X......|...X......|...X......|...X......",
				"..........|....X.....|....X.....|....X.....|....X.....",
				"..........|.....X....|.....X....|.....X....|.....X....",
				"..........|......X...|......X...|......X...|......X...",
				"..........|.......X..|.......X..|.......X..|.......X..",
				"..........|........X.|........X.|........X.|........X.",
				"..........|.........X|.........X|.........X|.........X",
			};
			AssertGetFields(exp, Block.I);
		}

		[Test]
		public void GetFields_S_17candidates()
		{
			var exp = new string[]
			{ 
				"..........|..........|..........|.XX.......|XX........",
				"..........|..........|..........|..XX......|.XX.......",
				"..........|..........|..........|...XX.....|..XX......",
				"..........|..........|..........|....XX....|...XX.....",
				"..........|..........|..........|.....XX...|....XX....",
				"..........|..........|..........|......XX..|.....XX...",
				"..........|..........|..........|.......XX.|......XX..",
				"..........|..........|..........|........XX|.......XX.",

				"..........|..........|X.........|XX........|.X........",
				"..........|..........|.X........|.XX.......|..X.......",
				"..........|..........|..X.......|..XX......|...X......",
				"..........|..........|...X......|...XX.....|....X.....",
				"..........|..........|....X.....|....XX....|.....X....",
				"..........|..........|.....X....|.....XX...|......X...",
				"..........|..........|......X...|......XX..|.......X..",
				"..........|..........|.......X..|.......XX.|........X.",
				"..........|..........|........X.|........XX|.........X",
			};
			AssertGetFields(exp, Block.S);
		}
		[Test]
		public void GetFields_Z_17candidates()
		{
			var exp = new string[]
			{
				"..........|..........|..........|XX........|.XX.......",
				"..........|..........|..........|.XX.......|..XX......",
				"..........|..........|..........|..XX......|...XX.....",
				"..........|..........|..........|...XX.....|....XX....",
				"..........|..........|..........|....XX....|.....XX...",
				"..........|..........|..........|.....XX...|......XX..",
				"..........|..........|..........|......XX..|.......XX.",
				"..........|..........|..........|.......XX.|........XX",
				
				"..........|..........|.X........|XX........|X.........",
				"..........|..........|..X.......|.XX.......|.X........",
				"..........|..........|...X......|..XX......|..X.......",
				"..........|..........|....X.....|...XX.....|...X......",
				"..........|..........|.....X....|....XX....|....X.....",
				"..........|..........|......X...|.....XX...|.....X....",
				"..........|..........|.......X..|......XX..|......X...",
				"..........|..........|........X.|.......XX.|.......X..",
				"..........|..........|.........X|........XX|........X.",
			};
			AssertGetFields(exp, Block.Z);
		}

		[Test]
		public void GetFields_J_34candidates()
		{
			var exp = new string[]
			{
				"..........|..........|..........|X.........|XXX.......",
				"..........|..........|..........|.X........|.XXX......",
				"..........|..........|..........|..X.......|..XXX.....",
				"..........|..........|..........|...X......|...XXX....",
				"..........|..........|..........|....X.....|....XXX...",
				"..........|..........|..........|.....X....|.....XXX..",
				"..........|..........|..........|......X...|......XXX.",
				"..........|..........|..........|.......X..|.......XXX",

				"..........|..........|.X........|.X........|XX........",
				"..........|..........|..X.......|..X.......|.XX.......",
				"..........|..........|...X......|...X......|..XX......",
				"..........|..........|....X.....|....X.....|...XX.....",
				"..........|..........|.....X....|.....X....|....XX....",
				"..........|..........|......X...|......X...|.....XX...",
				"..........|..........|.......X..|.......X..|......XX..",
				"..........|..........|........X.|........X.|.......XX.",
				"..........|..........|.........X|.........X|........XX",

				"..........|..........|..........|XXX.......|..X.......",
				"..........|..........|..........|.XXX......|...X......",
				"..........|..........|..........|..XXX.....|....X.....",
				"..........|..........|..........|...XXX....|.....X....",
				"..........|..........|..........|....XXX...|......X...",
				"..........|..........|..........|.....XXX..|.......X..",
				"..........|..........|..........|......XXX.|........X.",
				"..........|..........|..........|.......XXX|.........X",

				"..........|..........|XX........|X.........|X.........",
				"..........|..........|.XX.......|.X........|.X........",
				"..........|..........|..XX......|..X.......|..X.......",
				"..........|..........|...XX.....|...X......|...X......",
				"..........|..........|....XX....|....X.....|....X.....",
				"..........|..........|.....XX...|.....X....|.....X....",
				"..........|..........|......XX..|......X...|......X...",
				"..........|..........|.......XX.|.......X..|.......X..",
				"..........|..........|........XX|........X.|........X.",
			};
			AssertGetFields(exp, Block.J);
		}
		[Test]
		public void GetFields_L_34candidates()
		{
			var exp = new string[]
			{
				"..........|..........|..........|..X.......|XXX.......",
				"..........|..........|..........|...X......|.XXX......",
				"..........|..........|..........|....X.....|..XXX.....",
				"..........|..........|..........|.....X....|...XXX....",
				"..........|..........|..........|......X...|....XXX...",
				"..........|..........|..........|.......X..|.....XXX..",
				"..........|..........|..........|........X.|......XXX.",
				"..........|..........|..........|.........X|.......XXX",

				"..........|..........|XX........|.X........|.X........",
				"..........|..........|.XX.......|..X.......|..X.......",
				"..........|..........|..XX......|...X......|...X......",
				"..........|..........|...XX.....|....X.....|....X.....",
				"..........|..........|....XX....|.....X....|.....X....",
				"..........|..........|.....XX...|......X...|......X...",
				"..........|..........|......XX..|.......X..|.......X..",
				"..........|..........|.......XX.|........X.|........X.",
				"..........|..........|........XX|.........X|.........X",

				"..........|..........|..........|XXX.......|X.........",
				"..........|..........|..........|.XXX......|.X........",
				"..........|..........|..........|..XXX.....|..X.......",
				"..........|..........|..........|...XXX....|...X......",
				"..........|..........|..........|....XXX...|....X.....",
				"..........|..........|..........|.....XXX..|.....X....",
				"..........|..........|..........|......XXX.|......X...",
				"..........|..........|..........|.......XXX|.......X..",

				"..........|..........|X.........|X.........|XX........",
				"..........|..........|.X........|.X........|.XX.......",
				"..........|..........|..X.......|..X.......|..XX......",
				"..........|..........|...X......|...X......|...XX.....",
				"..........|..........|....X.....|....X.....|....XX....",
				"..........|..........|.....X....|.....X....|.....XX...",
				"..........|..........|......X...|......X...|......XX..",
				"..........|..........|.......X..|.......X..|.......XX.",
				"..........|..........|........X.|........X.|........XX",
			};
			AssertGetFields(exp, Block.L);
		}

		[Test]
		public void GetFields_T_34candidates()
		{
			var exp = new string[]
			{
				"..........|..........|..........|.X........|XXX.......",
				"..........|..........|..........|..X.......|.XXX......",
				"..........|..........|..........|...X......|..XXX.....",
				"..........|..........|..........|....X.....|...XXX....",
				"..........|..........|..........|.....X....|....XXX...",
				"..........|..........|..........|......X...|.....XXX..",
				"..........|..........|..........|.......X..|......XXX.",
				"..........|..........|..........|........X.|.......XXX",

				"..........|..........|.X........|XX........|.X........",
				"..........|..........|..X.......|.XX.......|..X.......",
				"..........|..........|...X......|..XX......|...X......",
				"..........|..........|....X.....|...XX.....|....X.....",
				"..........|..........|.....X....|....XX....|.....X....",
				"..........|..........|......X...|.....XX...|......X...",
				"..........|..........|.......X..|......XX..|.......X..",
				"..........|..........|........X.|.......XX.|........X.",
				"..........|..........|.........X|........XX|.........X",

				"..........|..........|..........|XXX.......|.X........",
				"..........|..........|..........|.XXX......|..X.......",
				"..........|..........|..........|..XXX.....|...X......",
				"..........|..........|..........|...XXX....|....X.....",
				"..........|..........|..........|....XXX...|.....X....",
				"..........|..........|..........|.....XXX..|......X...",
				"..........|..........|..........|......XXX.|.......X..",
				"..........|..........|..........|.......XXX|........X.",

				"..........|..........|X.........|XX........|X.........",
				"..........|..........|.X........|.XX.......|.X........",
				"..........|..........|..X.......|..XX......|..X.......",
				"..........|..........|...X......|...XX.....|...X......",
				"..........|..........|....X.....|....XX....|....X.....",
				"..........|..........|.....X....|.....XX...|.....X....",
				"..........|..........|......X...|......XX..|......X...",
				"..........|..........|.......X..|.......XX.|.......X..",
				"..........|..........|........X.|........XX|........X.",
			};
			AssertGetFields(exp, Block.T);
		}

		private static void AssertGetFields(string[] exp, Block block)
		{
			var generator = new MoveGenerator();
			var candidateFields = generator.GetMoves(TestData.Small, block, false).Select(candidate => candidate.Field.ToString()).ToArray();
			var fields = generator.GetFields(TestData.Small, block, false).Select(field => field.ToString()).ToArray();

			foreach (var field in candidateFields)
			{
				Console.WriteLine('"' + field + '"' + ',');
			}

			foreach (var field in candidateFields)
			{
				Console.WriteLine(field.Replace("|", Environment.NewLine));
				Console.WriteLine();
			}
			Assert.AreEqual(block.ChildCount, candidateFields.Length, "GetMoves for {0} has the wrong number of answers.", block.Name);
			CollectionAssert.AreEqual(exp, candidateFields, "Moves");
			CollectionAssert.AreEqual(exp, fields, "Fields");
		}
	}
}
